<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>â¤å½¬å½¬ç»™é¹é¹çš„ä¸“å±æƒ…ä¹¦â¤</title>
    <link rel="icon" type="image/x-icon" href="https://i.loli.net/2021/06/03/lFg2V4WUcmkB98G.png">
    <meta name="language" content="zh-CN">
    <meta name="title" content="å½¬å½¬çš„æƒ…ä¹¦">
    <meta name="github" content="https://github.com/sun0225SUN/Awesome-Love-Code">
    <meta name="describe" content="å½¬å½¬çˆ±é¹é¹ï¼Œç›´åˆ°æ°¸è¿œ">
    <link type="text/css" rel="stylesheet" href="./Love_files/default.css">
    <script type="text/javascript" src="./Love_files/jquery.min.js"></script>
    <script type="text/javascript" src="./Love_files/jscex.min.js"></script>
    <script type="text/javascript" src="./Love_files/jscex-parser.js"></script>
    <script type="text/javascript" src="./Love_files/jscex-jit.js"></script>
    <script type="text/javascript" src="./Love_files/jscex-builderbase.min.js"></script>
    <script type="text/javascript" src="./Love_files/jscex-async.min.js"></script>
    <script type="text/javascript" src="./Love_files/jscex-async-powerpack.min.js"></script>
    <script type="text/javascript" src="./Love_files/functions.js" charset="utf-8"></script>
    <script type="text/javascript" src="./Love_files/love.js" charset="utf-8"></script>
    <style>
        /* æµªæ¼«è‡ªå®šä¹‰æ ·å¼ */
        .romantic-text {
            color: #e91e63;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        
        .main-title {
            font-size: 28px;
            color: #ff4081;
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
            letter-spacing: 2px;
        }
        
        .duration-placeholder {
            color: #ff4081;
            font-weight: bold;
            position: relative;
            display: inline-block;
            padding: 0 5px;
            border-bottom: 2px solid #ffc8dd;
            background: rgba(255, 200, 221, 0.2);
            border-radius: 4px;
        }
        
        /* çˆ±æƒ…çºªå¿µå†Œæ ·å¼ - åŠ¨æ€åˆ›å»º */
        .love-album {
            text-align: center;
            margin: 25px auto;
            padding: 20px;
            background: rgba(255, 250, 252, 0.98);
            border-radius: 15px;
            max-width: 650px;
            box-shadow: 0 8px 25px rgba(255, 64, 129, 0.2);
            border: 2px solid #ffc8dd;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1s ease forwards 1s;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .love-album h3 {
            color: #e91e63;
            font-size: 24px;
            margin-bottom: 15px;
            font-weight: bold;
            position: relative;
            display: inline-block;
            padding-bottom: 10px;
        }
        
        .love-album h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 25%;
            width: 50%;
            height: 3px;
            background: linear-gradient(90deg, #ffc8dd, #e91e63, #ffc8dd);
            border-radius: 2px;
        }
        
        .love-metric {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .metric-box {
            background: white;
            padding: 20px;
            border-radius: 12px;
            flex: 1;
            min-width: 180px;
            box-shadow: 0 4px 12px rgba(233, 30, 99, 0.15);
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid #ffc8dd;
            text-align: center;
        }
        
        .metric-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(233, 30, 99, 0.25);
        }
        
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #e91e63;
            margin: 10px 0;
            display: block;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .metric-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }
        
        .heart-icon {
            color: #ff4081;
            font-size: 20px;
            margin: 0 8px;
            animation: heartbeat 1.5s infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .romantic-date {
            font-size: 18px;
            color: #333;
            margin: 15px 0;
            padding: 12px;
            background: linear-gradient(135deg, #fff5f7, #ffe4e9);
            border-radius: 10px;
            border: 1px solid #ffc8dd;
            font-weight: 500;
        }
        
        .love-note {
            margin-top: 20px;
            font-style: italic;
            color: #666;
            font-size: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #fff, #fff9fb);
            border-radius: 10px;
            border: 1px solid #ffc8dd;
            line-height: 1.6;
        }
        
        .special-day {
            animation: glow 2s infinite alternate;
            color: #ff4081 !important;
            font-weight: bold;
            padding: 3px 8px;
            background: rgba(255, 64, 129, 0.1);
            border-radius: 5px;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(255, 64, 129, 0.5); }
            to { box-shadow: 0 0 15px rgba(255, 64, 129, 0.8); }
        }
        
        /* æµ®åŠ¨çˆ±å¿ƒèƒŒæ™¯ */
        .floating-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.6;
        }
        
        .floating-heart {
            position: absolute;
            color: #ffb6c1;
            font-size: 18px;
            animation: float 15s infinite linear;
        }
        
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.7; }
            90% { opacity: 0.7; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }
        
        /* ç‚¹å‡»ç§å­æ ·å¼ */
        .seed-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ffc8dd, #ffafcc, #ffc8dd);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            cursor: pointer;
        }
        
        .seed-container.hidden {
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease;
        }
        
        .seed-message {
            text-align: center;
            color: white;
            padding: 40px;
            background: rgba(233, 30, 99, 0.9);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: pulse 2s infinite;
        }
        
        .seed-message h2 {
            font-size: 36px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .seed-message p {
            font-size: 20px;
            margin: 10px 0;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* æƒ…ä¹¦å†…å®¹åŒºåŸŸ */
        #text {
            min-height: 400px;
            padding: 20px;
            margin-bottom: 20px;
            opacity: 0;
            transition: opacity 2s ease;
        }
        
        #text.show {
            opacity: 1;
        }
        
        /* ç”»å¸ƒæ ·å¼ */
        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            pointer-events: none;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .love-metric {
                flex-direction: column;
                align-items: center;
            }
            
            .metric-box {
                width: 100%;
                max-width: 300px;
            }
            
            .seed-message h2 {
                font-size: 28px;
            }
            
            .seed-message p {
                font-size: 16px;
            }
            
            #text {
                min-height: 300px;
                padding: 15px;
            }
        }
        
        /* éŸ³ä¹æ§åˆ¶æŒ‰é’® */
        .music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border: 2px solid #ffc8dd;
            opacity: 0;
            transition: opacity 1s ease;
            display: none;
        }
        
        .music-control.show {
            display: flex;
            opacity: 1;
        }
        
        .music-control i {
            color: #e91e63;
            font-size: 24px;
        }
    </style>
</head>

<body>
    <!-- ç‚¹å‡»ç§å­é¡µé¢ - è¿™æ˜¯æœ€åˆçš„é¡µé¢ -->
    <div class="seed-container" id="seedContainer">
        <div class="seed-message">
            <h2>â¤ çˆ±çš„ç§å­ â¤</h2>
            <p>ç‚¹å‡»è¿™é¢—ç§å­ï¼Œè®©å®ƒé•¿æˆæˆ‘ä»¬çš„çˆ±æƒ…æ ‘</p>
            <p>å½¬å½¬ â¤ é¹é¹</p>
            <p>ä» 2024å¹´5æœˆ24æ—¥ å¼€å§‹</p>
        </div>
    </div>
    
    <!-- æµ®åŠ¨çˆ±å¿ƒèƒŒæ™¯ -->
    <div class="floating-hearts" id="floating-hearts"></div>
    
    <!-- éŸ³ä¹æ§åˆ¶æŒ‰é’® -->
    <div class="music-control" id="musicControl">
        <i>ğŸµ</i>
    </div>
    
    <!-- ä¸»å†…å®¹åŒºåŸŸ - åˆå§‹å®Œå…¨éšè— -->
    <div id="main" style="display: none; opacity: 0;">
        <div id="error">äº²ï¼Œæ‚¨ä½¿ç”¨çš„æµè§ˆå™¨æ— æ³•æ”¯æŒå³å°†æ˜¾ç¤ºçš„å†…å®¹ï¼Œè¯·æ¢æˆè°·æ­Œ(<a
                href="http://www.google.cn/chrome/intl/zh-CN/landing_chrome.html?hl=zh-CN&brand=CHMI">Chrome</a>)æˆ–è€…ç«ç‹(<a
                href="http://firefox.com.cn/download/">Firefox</a>)æµè§ˆå™¨å“Ÿ~</div>
        <div id="wrap">
            <!-- æƒ…ä¹¦åŒºåŸŸ -->
            <div id="text">
                <div id="code">
                    <div class="main-title">ä¸€å®šä¼šçˆ±ä½ </div>
                    <span class="say">æˆ‘çŸ¥é“ï¼Œä½ æ˜¯ä¸€ä¸ªå¤©çœŸã€å–„è‰¯åˆæ¸©æŸ”çš„ç”·å­©</span><br>
                    <span class="say">è¿™æ®µå’Œä½ å¹¶è‚©èµ°è¿‡çš„<span id="duration" class="duration-placeholder">[åŠ è½½ä¸­...]</span>æ—¶å…‰ï¼Œæ˜¯æˆ‘ç”Ÿå‘½é‡Œæœ€æ˜äº®çš„ç« èŠ‚</span><br>
                    <span class="say">å¦‚æœä½ æ„¿æ„ï¼Œè®©æˆ‘ç‰µç´§ä½ çš„æ‰‹ï¼Œåœ¨å±äºæˆ‘ä»¬çš„æ•…äº‹é‡Œ</span><br>
                    <span class="say">å¥½å¥½åœ°ã€å®Œæ•´åœ°å»çˆ±ä¸€æ¬¡</span><br>
                    <br>
                    <span class="say">æˆ‘çˆ±ä½ ï¼Œçˆ±åˆ°æ˜¼å¤œåœ¨å¯»å¸¸å··é™Œé‡Œä¸ºæˆ‘ä»¬è§è¯</span><br>
                    <span class="say">çˆ±åˆ°å››å­£æµè½¬éƒ½æˆä¸ºæˆ‘ä»¬ç›¸å®ˆçš„åºç« </span><br>
                    <span class="say">çˆ±åˆ°æ¯ä¸€ç¼•é£ç»è¿‡ï¼Œéƒ½è®¤å¾—æˆ‘ä¿©å¹¶è‚©çš„èº«å½±</span><br>
                    <span class="say">çˆ±åˆ°ä¸–ç•Œå®‰é™æ—¶ï¼Œåªå¬å¾—åˆ°å½¼æ­¤çš„å¿ƒè·³</span><br>
                    <br>
                    <span class="say">æˆ‘çˆ±ä½ ï¼Œçˆ±åˆ°æ—¶é—´å¤±å»åˆ»åº¦ï¼Œæœªæ¥ä¸å¿…åˆ†æ˜</span><br>
                    <span class="say">çˆ±åˆ°æ— è®ºé‡æ¥å¤šå°‘æ¬¡ï¼Œé€‰æ‹©ä¾ç„¶ä¼šæ˜¯ä½ </span><br>
                    <span class="say">å°±æŠŠè¿™äº›è¯è¯´ç»™æˆ‘æœ€äº²çˆ±çš„ç”·å­©å¬</span><br>
                    <span class="say">æ„¿ä»¥çœŸå¿ƒï¼Œæ¢ä½ æˆ‘å¾€åæœæœæš®æš®</span><br>
                    <span class="say">è®©æˆ‘å¥½å¥½çˆ±ä½ ï¼Œè¡Œå—</span><br>
                    <br>
                    <span class="say"><span class="space"></span> -- æ°¸è¿œçˆ±ä½ çš„å½¬å½¬ã€‚</span>
                </div>
            </div>
            
            <!-- æ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰çˆ±æƒ…çºªå¿µå†Œï¼å®ƒä¼šåœ¨åŠ¨ç”»ç»“æŸååŠ¨æ€åˆ›å»º -->
            
            <div id="clock-box">
                <span class="romantic-text">å½¬å½¬</span> 
                <span class="heart-icon">â¤</span> å’Œ 
                <span class="heart-icon">â¤</span>
                <span class="romantic-text">é¹é¹</span> çš„çˆ±æƒ…å†ç¨‹
                <div id="clock"></div>
            </div>
        </div>
    </div>
    
    <!-- ç”»å¸ƒ - ç”¨äºå¤§æ ‘ç”Ÿé•¿åŠ¨ç”» -->
    <canvas id="canvas" width="1100" height="680"></canvas>

    <!-- éŸ³é¢‘ -->
    <audio preload="auto" id="media" loop="loop">
        <source src="love.mp3" type="audio/mpeg">
        <source src="love.ogg" type="audio/ogg">
    </audio>

    <script>
        // å¼€å§‹æ—¥æœŸ
        const startDate = new Date('2024-05-24');
        
        // åŠ¨ç”»çŠ¶æ€
        let animationStarted = false;
        
        // éŸ³ä¹æ§åˆ¶
        const audio = document.getElementById('media');
        const musicControl = document.getElementById('musicControl');
        let musicStarted = false;
        
        // åˆå§‹åŒ–éŸ³ä¹
        audio.volume = 0.5;
        
        // éŸ³ä¹æ§åˆ¶
        musicControl.addEventListener('click', function() {
            if (audio.paused) {
                audio.play();
                musicControl.innerHTML = '<i>ğŸµ</i>';
            } else {
                audio.pause();
                musicControl.innerHTML = '<i>ğŸ”‡</i>';
            }
        });
        
        // åˆ›å»ºæµ®åŠ¨çˆ±å¿ƒ
        function createFloatingHearts() {
            const heartsContainer = document.getElementById('floating-hearts');
            const heartCount = 20;
            
            for (let i = 0; i < heartCount; i++) {
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                heart.innerHTML = 'â¤';
                heart.style.left = Math.random() * 100 + '%';
                heart.style.fontSize = (Math.random() * 12 + 10) + 'px';
                heart.style.animationDelay = Math.random() * 15 + 's';
                heart.style.animationDuration = (Math.random() * 10 + 15) + 's';
                heart.style.color = `rgba(255, ${Math.random() * 100 + 64}, ${Math.random() * 100 + 129}, 0.6)`;
                heartsContainer.appendChild(heart);
            }
        }

         // åˆ›å»ºçˆ±æƒ…çºªå¿µå†Œçš„å‡½æ•° - è¯¦ç»†è§£é‡Šç‰ˆ
        function createLoveAlbum() {
            console.log('å¼€å§‹åˆ›å»ºçˆ±æƒ…çºªå¿µå†Œ...');
            
            // 1. é¦–å…ˆæ‰¾åˆ°è¦æ’å…¥çš„ä½ç½®
            // clock-boxæ˜¯é¡µé¢ä¸Šå·²æœ‰çš„å…ƒç´ ï¼Œæˆ‘ä»¬è¦åœ¨å®ƒå‰é¢æ’å…¥çºªå¿µå†Œ
            const clockBox = document.getElementById('clock-box');
            
            if (!clockBox) {
                console.error('æ‰¾ä¸åˆ°clock-boxå…ƒç´ ï¼');
                return;
            }
            
            // 2. åˆ›å»ºçºªå¿µå†Œçš„HTMLå­—ç¬¦ä¸²
            // è¿™é‡Œä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²ï¼ˆåå¼•å·ï¼‰ï¼Œå¯ä»¥åŒ…å«å¤šè¡ŒHTMLå’Œå˜é‡
            const albumHTML = `
                <div class="love-album">
                    <h3>â¤ æˆ‘ä»¬çš„çˆ±æƒ…çºªå¿µå†Œ â¤</h3>
                    
                    <div class="romantic-date">
                        <span class="heart-icon">â¤</span>
                        ä»Šå¤©ï¼š<span id="current-date">${getCurrentDate()}</span>
                        <span class="heart-icon">â¤</span>
                    </div>
                    
                    <div class="love-metric">
                        <div class="metric-box">
                            <span class="metric-label">åœ¨ä¸€èµ·å¤©æ•°</span>
                            <span class="metric-value">${calculateTogetherDays()}</span>
                            <span class="heart-icon">â¤</span>
                        </div>
                        
                        <div class="metric-box">
                            <span class="metric-label">ä¸‹ä¸ªçºªå¿µæ—¥</span>
                            <span class="metric-value">${calculateNextHundredDays()}</span>
                            <span class="metric-label">å¤©å</span>
                        </div>
                        
                        <div class="metric-box">
                            <span class="metric-label">çˆ±æƒ…æ¸©åº¦</span>
                            <span class="metric-value">100Â°</span>
                            <span class="heart-icon">â™¥</span>
                        </div>
                    </div>
                    
                    <div class="love-note">
                        æ¯ä¸€åˆ†æ¯ä¸€ç§’ï¼Œçˆ±ä½ éƒ½åœ¨åŠ æ·±ä¸€åˆ†<br>
                        ä» <span style="color: #e91e63; font-weight: bold;">${getStartDate()}</span> å¼€å§‹ï¼Œæˆ‘ä»¬çš„æ•…äº‹æ°¸ä¸ç»“æŸ
                    </div>
                </div>
            `;
            
            // 3. åœ¨clock-boxå…ƒç´ ä¹‹å‰æ’å…¥çºªå¿µå†Œ
            // insertAdjacentHTMLæœ‰4ä¸ªä½ç½®å¯é€‰ï¼š
            // 'beforebegin': åœ¨å…ƒç´ å‰é¢æ’å…¥ï¼ˆä½œä¸ºå…„å¼Ÿå…ƒç´ ï¼‰
            // 'afterbegin': åœ¨å…ƒç´ å†…éƒ¨çš„å¼€å¤´æ’å…¥
            // 'beforeend': åœ¨å…ƒç´ å†…éƒ¨çš„ç»“å°¾æ’å…¥
            // 'afterend': åœ¨å…ƒç´ åé¢æ’å…¥ï¼ˆä½œä¸ºå…„å¼Ÿå…ƒç´ ï¼‰
            clockBox.insertAdjacentHTML('beforebegin', albumHTML);
            
            console.log('çˆ±æƒ…çºªå¿µå†Œåˆ›å»ºå®Œæˆï¼');
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šè·å–å½“å‰æ—¥æœŸ
        function getCurrentDate() {
            const now = new Date();
            return now.toLocaleDateString('zh-CN', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric', 
                weekday: 'long' 
            });
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šè·å–å¼€å§‹æ—¥æœŸ
        function getStartDate() {
            return startDate.toLocaleDateString('zh-CN', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }
        
        // 4. åœ¨é€‚å½“çš„æ—¶é—´è°ƒç”¨è¿™ä¸ªå‡½æ•°
        // æ¯”å¦‚åœ¨æƒ…ä¹¦åŠ¨ç”»å®Œæˆåè°ƒç”¨
        function showLoveLetter() {
            // æ˜¾ç¤ºæƒ…ä¹¦...
            $("#code").show().typewriter();
            
            // 10ç§’åï¼ˆæƒ…ä¹¦æ‰“å­—å®Œæˆåï¼‰åˆ›å»ºçºªå¿µå†Œ
            setTimeout(() => {
                createLoveAlbum();
            }, 10000);
        }
        
        // è®¡ç®—æ—¶é—´é—´éš”
        function calculateRomanticDuration() {
            const now = new Date();
            const diffTime = Math.abs(now - startDate);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return "åˆšåˆšå¼€å§‹çš„ç¾å¥½";
            if (diffDays === 1) return "ç”œèœœçš„ç¬¬ä¸€å¤©";
            if (diffDays < 7) return diffDays + "ä¸ªç”œèœœæ—¥å¤œ";
            if (diffDays < 30) {
                const weeks = Math.floor(diffDays / 7);
                return weeks + "å‘¨çš„ç¾å¥½æ—¶å…‰";
            }
            if (diffDays < 365) {
                const months = Math.floor(diffDays / 30);
                const days = diffDays % 30;
                return months + "ä¸ªæœˆ" + (days > 0 ? days + "å¤©" : "") + "çš„é™ªä¼´";
            }
            const years = Math.floor(diffDays / 365);
            const months = Math.floor((diffDays % 365) / 30);
            return years + "å¹´" + (months > 0 ? months + "ä¸ªæœˆ" : "") + "çš„æ°¸æ’ä¹‹çº¦";
        }
        
        // è®¡ç®—åœ¨ä¸€èµ·å¤©æ•°
        function calculateTogetherDays() {
            const now = new Date();
            const diffTime = Math.abs(now - startDate);
            return Math.floor(diffTime / (1000 * 60 * 60 * 24));
        }
        
        // è®¡ç®—è·ç¦»ä¸‹ä¸€ä¸ªç™¾å¤©çºªå¿µæ—¥
        function calculateNextHundredDays() {
            const togetherDays = calculateTogetherDays();
            const nextHundred = Math.ceil((togetherDays + 1) / 100) * 100;
            return nextHundred - togetherDays;
        }
        
        // åˆ›å»ºçˆ±æƒ…çºªå¿µå†Œ - åœ¨åŠ¨ç”»å®Œå…¨ç»“æŸåæ‰è°ƒç”¨
        function createLoveAlbum() {
            const wrap = document.getElementById('wrap');
            const clockBox = document.getElementById('clock-box');
            
            // åˆ›å»ºçºªå¿µå†ŒHTML
            const albumHTML = `
                <div class="love-album">
                    <h3>â¤ æˆ‘ä»¬çš„çˆ±æƒ…çºªå¿µå†Œ â¤</h3>
                    
                    <div class="romantic-date">
                        <span class="heart-icon">â¤</span>
                        ä»Šå¤©ï¼š<span id="current-date">${new Date().toLocaleDateString('zh-CN', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric', 
                            weekday: 'long' 
                        })}</span>
                        <span class="heart-icon">â¤</span>
                    </div>
                    
                    <div class="love-metric">
                        <div class="metric-box">
                            <span class="metric-label">åœ¨ä¸€èµ·å¤©æ•°</span>
                            <span class="metric-value">${calculateTogetherDays()}</span>
                            <span class="heart-icon">â¤</span>
                        </div>
                        
                        <div class="metric-box">
                            <span class="metric-label">ä¸‹ä¸ªçºªå¿µæ—¥</span>
                            <span class="metric-value">${calculateNextHundredDays()}</span>
                            <span class="metric-label">å¤©å</span>
                        </div>
                        
                        <div class="metric-box">
                            <span class="metric-label">çˆ±æƒ…æ¸©åº¦</span>
                            <span class="metric-value">100Â°</span>
                            <span class="heart-icon">â™¥</span>
                        </div>
                    </div>
                    
                    <div class="love-note">
                        æ¯ä¸€åˆ†æ¯ä¸€ç§’ï¼Œçˆ±ä½ éƒ½åœ¨åŠ æ·±ä¸€åˆ†<br>
                        ä» <span style="color: #e91e63; font-weight: bold;">${startDate.toLocaleDateString('zh-CN', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        })}</span> å¼€å§‹ï¼Œæˆ‘ä»¬çš„æ•…äº‹æ°¸ä¸ç»“æŸ
                    </div>
                </div>
            `;
            
            // åœ¨æ—¶é’Ÿç›’å­ä¹‹å‰æ’å…¥çºªå¿µå†Œ
            clockBox.insertAdjacentHTML('beforebegin', albumHTML);
        }
        
        // å¼€å§‹ä½“éªŒ
        function startExperience() {
            if (animationStarted) return;
            animationStarted = true;
            
            const seedContainer = document.getElementById('seedContainer');
            const mainContent = document.getElementById('main');
            const textElement = document.getElementById('text');
            
            // æ·¡å‡ºç§å­é¡µé¢
            seedContainer.classList.add('hidden');
            
            // å¼€å§‹éŸ³ä¹
            if (!musicStarted) {
                audio.play().then(() => {
                    musicStarted = true;
                });
            }
            
            // 1ç§’åå¼€å§‹åŠ¨ç”»
            setTimeout(() => {
                seedContainer.style.display = 'none';
                mainContent.style.display = 'block';
                
                // æ˜¾ç¤ºéŸ³ä¹æ§åˆ¶æŒ‰é’®
                setTimeout(() => {
                    musicControl.classList.add('show');
                }, 2000);
                
                // æ›´æ–°æƒ…ä¹¦ä¸­çš„æ—¶é—´
                document.getElementById('duration').textContent = calculateRomanticDuration();
                
                // å¼€å§‹å¤§æ ‘ç”Ÿé•¿åŠ¨ç”»
                startTreeAnimation();
                
                // 3ç§’åæ˜¾ç¤ºæƒ…ä¹¦ï¼ˆæ‰“å­—æ•ˆæœï¼‰
                setTimeout(() => {
                    textElement.classList.add('show');
                    $("#code").show().typewriter();
                    
                    // æƒ…ä¹¦åŠ¨ç”»å®Œæˆåï¼ˆçº¦10ç§’åï¼‰ï¼Œåˆ›å»ºå¹¶æ˜¾ç¤ºçˆ±æƒ…çºªå¿µå†Œ
                    setTimeout(createLoveAlbum, 10000);
                }, 3000);
                
            }, 1000);
        }
        
        // å¼€å§‹å¤§æ ‘ç”Ÿé•¿åŠ¨ç”»
        function startTreeAnimation() {
            if (window.initAnimation) {
                window.initAnimation();
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            createFloatingHearts();
            document.getElementById('seedContainer').addEventListener('click', startExperience);
        });

        // åŸæœ‰çš„åŠ¨ç”»ä»£ç 
        (function () {
            var canvas = $('#canvas');

            if (!canvas[0].getContext) {
                $("#error").show();
                return false;
            }

            var width = canvas.width();
            var height = canvas.height();

            canvas.attr("width", width);
            canvas.attr("height", height);

            var opts = {
                seed: {
                    x: width / 2 - 20,
                    color: "rgb(190, 26, 37)",
                    scale: 2
                },
                branch: [
                    [535, 680, 570, 250, 500, 200, 30, 100, [
                        [540, 500, 455, 417, 340, 400, 13, 100, [
                            [450, 435, 434, 430, 394, 395, 2, 40]
                        ]],
                        [550, 445, 600, 356, 680, 345, 12, 100, [
                            [578, 400, 648, 409, 661, 426, 3, 80]
                        ]],
                        [539, 281, 537, 248, 534, 217, 3, 40],
                        [546, 397, 413, 247, 328, 244, 9, 80, [
                            [427, 286, 383, 253, 371, 205, 2, 40],
                            [498, 345, 435, 315, 395, 330, 4, 60]
                        ]],
                        [546, 357, 608, 252, 678, 221, 6, 100, [
                            [590, 293, 646, 277, 648, 271, 2, 80]
                        ]]
                    ]]
                ],
                bloom: {
                    num: 700,
                    width: 1080,
                    height: 650,
                },
                footer: {
                    width: 1200,
                    height: 5,
                    speed: 10,
                }
            }

            var tree = new Tree(canvas[0], width, height, opts);
            var seed = tree.seed;
            var foot = tree.footer;
            var hold = 1;

            var seedAnimate = eval(Jscex.compile("async", function () {
                seed.draw();
                while (hold) {
                    $await(Jscex.Async.sleep(10));
                }
                while (seed.canScale()) {
                    seed.scale(0.95);
                    $await(Jscex.Async.sleep(10));
                }
                while (seed.canMove()) {
                    seed.move(0, 2);
                    foot.draw();
                    $await(Jscex.Async.sleep(10));
                }
            }));

            var growAnimate = eval(Jscex.compile("async", function () {
                do {
                    tree.grow();
                    $await(Jscex.Async.sleep(10));
                } while (tree.canGrow());
            }));

            var flowAnimate = eval(Jscex.compile("async", function () {
                do {
                    tree.flower(2);
                    $await(Jscex.Async.sleep(10));
                } while (tree.canFlower());
            }));

            var moveAnimate = eval(Jscex.compile("async", function () {
                tree.snapshot("p1", 240, 0, 610, 680);
                while (tree.move("p1", 500, 0)) {
                    foot.draw();
                    $await(Jscex.Async.sleep(10));
                }
                foot.draw();
                tree.snapshot("p2", 500, 0, 610, 680);

                canvas.parent().css("background", "url(" + tree.toDataURL('image/png') + ")");
                canvas.css("background", "#ffc0cb");
                $await(Jscex.Async.sleep(300));
                canvas.css("background", "none");
            }));

            var jumpAnimate = eval(Jscex.compile("async", function () {
                var ctx = tree.ctx;
                while (true) {
                    tree.ctx.clearRect(0, 0, width, height);
                    tree.jump();
                    foot.draw();
                    $await(Jscex.Async.sleep(25));
                }
            }));

            var textAnimate = eval(Jscex.compile("async", function () {
                var together = new Date();
                together.setFullYear(2024, 4, 24);
                together.setHours(0);
                together.setMinutes(0);
                together.setSeconds(0);
                together.setMilliseconds(0);

                $("#clock-box").fadeIn(500);
                
                while (true) {
                    timeElapse(together);
                    $await(Jscex.Async.sleep(1000));
                }
            }));

            var runAsync = eval(Jscex.compile("async", function () {
                $await(seedAnimate());
                $await(growAnimate());
                $await(flowAnimate());
                $await(moveAnimate());

                textAnimate().start();

                $await(jumpAnimate());
            }));

            // å°†åŠ¨ç”»å¯åŠ¨å‡½æ•°å¯¼å‡º
            window.initAnimation = function() {
                hold = 0; // ç«‹å³å¼€å§‹åŠ¨ç”»
                runAsync().start();
            };
        })();
    </script>
</body>
</html>
