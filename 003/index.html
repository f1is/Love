<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>â¤å½¬å½¬ç»™é¹é¹çš„ä¸“å±æƒ…ä¹¦â¤</title>
    <link rel="icon" type="image/x-icon" href="https://i.loli.net/2021/06/03/lFg2V4WUcmkB98G.png">
    <meta name="language" content="zh-CN">
    <meta name="title" content="å½¬å½¬çš„æƒ…ä¹¦">
    <meta name="github" content="https://github.com/sun0225SUN/Awesome-Love-Code">
    <meta name="describe" content="å½¬å½¬çˆ±é¹é¹ï¼Œç›´åˆ°æ°¸è¿œ">
    <link type="text/css" rel="stylesheet" href="./Love_files/default.css">
    <script type="text/javascript" src="./Love_files/jquery.min.js"></script>
    <script type="text/javascript" src="./Love_files/jscex.min.js"></script>
    <script type="text/javascript" src="./Love_files/jscex-parser.js"></script>
    <script type="text/javascript" src="./Love_files/jscex-jit.js"></script>
    <script type="text/javascript" src="./Love_files/jscex-builderbase.min.js"></script>
    <script type="text/javascript" src="./Love_files/jscex-async.min.js"></script>
    <script type="text/javascript" src="./Love_files/jscex-async-powerpack.min.js"></script>
    <script type="text/javascript" src="./Love_files/functions.js" charset="utf-8"></script>
    <!-- love.js çš„å†…å®¹å°†è¢«ç›´æ¥æ•´åˆåˆ°é¡µé¢ä¸­ -->
    
    <style>
        /* æ‰€æœ‰ä¹‹å‰çš„CSSæ ·å¼ä¿æŒä¸å˜ */
        .romantic-text {
            color: #e91e63;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        
        .main-title {
            font-size: 28px;
            color: #ff4081;
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
            letter-spacing: 2px;
        }
        
        .duration-placeholder {
            color: #ff4081;
            font-weight: bold;
            position: relative;
            display: inline-block;
            padding: 0 5px;
            border-bottom: 2px solid #ffc8dd;
            background: rgba(255, 200, 221, 0.2);
            border-radius: 4px;
        }
        
        .love-album {
            text-align: center;
            margin: 25px auto;
            padding: 20px;
            background: rgba(255, 250, 252, 0.98);
            border-radius: 15px;
            max-width: 650px;
            box-shadow: 0 8px 25px rgba(255, 64, 129, 0.2);
            border: 2px solid #ffc8dd;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1s ease forwards 1s;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .love-album h3 {
            color: #e91e63;
            font-size: 24px;
            margin-bottom: 15px;
            font-weight: bold;
            position: relative;
            display: inline-block;
            padding-bottom: 10px;
        }
        
        .love-album h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 25%;
            width: 50%;
            height: 3px;
            background: linear-gradient(90deg, #ffc8dd, #e91e63, #ffc8dd);
            border-radius: 2px;
        }
        
        .love-metric {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .metric-box {
            background: white;
            padding: 20px;
            border-radius: 12px;
            flex: 1;
            min-width: 180px;
            box-shadow: 0 4px 12px rgba(233, 30, 99, 0.15);
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid #ffc8dd;
            text-align: center;
        }
        
        .metric-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(233, 30, 99, 0.25);
        }
        
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #e91e63;
            margin: 10px 0;
            display: block;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .metric-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }
        
        .heart-icon {
            color: #ff4081;
            font-size: 20px;
            margin: 0 8px;
            animation: heartbeat 1.5s infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .romantic-date {
            font-size: 18px;
            color: #333;
            margin: 15px 0;
            padding: 12px;
            background: linear-gradient(135deg, #fff5f7, #ffe4e9);
            border-radius: 10px;
            border: 1px solid #ffc8dd;
            font-weight: 500;
        }
        
        .love-note {
            margin-top: 20px;
            font-style: italic;
            color: #666;
            font-size: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #fff, #fff9fb);
            border-radius: 10px;
            border: 1px solid #ffc8dd;
            line-height: 1.6;
        }
        
        .special-day {
            animation: glow 2s infinite alternate;
            color: #ff4081 !important;
            font-weight: bold;
            padding: 3px 8px;
            background: rgba(255, 64, 129, 0.1);
            border-radius: 5px;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(255, 64, 129, 0.5); }
            to { box-shadow: 0 0 15px rgba(255, 64, 129, 0.8); }
        }
        
        .floating-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.6;
        }
        
        .floating-heart {
            position: absolute;
            color: #ffb6c1;
            font-size: 18px;
            animation: float 15s infinite linear;
        }
        
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.7; }
            90% { opacity: 0.7; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }
        
        .seed-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ffc8dd, #ffafcc, #ffc8dd);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            cursor: pointer;
        }
        
        .seed-container.hidden {
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease;
        }
        
        .seed-message {
            text-align: center;
            color: white;
            padding: 40px;
            background: rgba(233, 30, 99, 0.9);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: pulse 2s infinite;
        }
        
        .seed-message h2 {
            font-size: 36px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .seed-message p {
            font-size: 20px;
            margin: 10px 0;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        #text {
            min-height: 400px;
            padding: 20px;
            margin-bottom: 20px;
            opacity: 0;
            transition: opacity 2s ease;
        }
        
        #text.show {
            opacity: 1;
        }
        
        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            pointer-events: none;
        }
        
        @media (max-width: 768px) {
            .love-metric {
                flex-direction: column;
                align-items: center;
            }
            
            .metric-box {
                width: 100%;
                max-width: 300px;
            }
            
            .seed-message h2 {
                font-size: 28px;
            }
            
            .seed-message p {
                font-size: 16px;
            }
            
            #text {
                min-height: 300px;
                padding: 15px;
            }
        }
        
        .music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border: 2px solid #ffc8dd;
            opacity: 0;
            transition: opacity 1s ease;
            display: none;
        }
        
        .music-control.show {
            display: flex;
            opacity: 1;
        }
        
        .music-control i {
            color: #e91e63;
            font-size: 24px;
        }
    </style>
</head>

<body>
    <!-- ç‚¹å‡»ç§å­é¡µé¢ -->
    <div class="seed-container" id="seedContainer">
        <div class="seed-message">
            <h2>â¤ çˆ±çš„ç§å­ â¤</h2>
            <p>ç‚¹å‡»è¿™é¢—ç§å­ï¼Œè®©å®ƒé•¿æˆæˆ‘ä»¬çš„çˆ±æƒ…æ ‘</p>
            <p>å½¬å½¬ â¤ é¹é¹</p>
            <p>ä» 2024å¹´5æœˆ24æ—¥ å¼€å§‹</p>
        </div>
    </div>
    
    <!-- æµ®åŠ¨çˆ±å¿ƒèƒŒæ™¯ -->
    <div class="floating-hearts" id="floating-hearts"></div>
    
    <!-- éŸ³ä¹æ§åˆ¶æŒ‰é’® -->
    <div class="music-control" id="musicControl">
        <i>ğŸµ</i>
    </div>
    
    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div id="main" style="display: none; opacity: 0;">
        <div id="error">äº²ï¼Œæ‚¨ä½¿ç”¨çš„æµè§ˆå™¨æ— æ³•æ”¯æŒå³å°†æ˜¾ç¤ºçš„å†…å®¹ï¼Œè¯·æ¢æˆè°·æ­Œ(<a
                href="http://www.google.cn/chrome/intl/zh-CN/landing_chrome.html?hl=zh-CN&brand=CHMI">Chrome</a>)æˆ–è€…ç«ç‹(<a
                href="http://firefox.com.cn/download/">Firefox</a>)æµè§ˆå™¨å“Ÿ~</div>
        <div id="wrap">
            <!-- æƒ…ä¹¦åŒºåŸŸ -->
            <div id="text">
                <div id="code">
                    <div class="main-title">ä¸€å®šä¼šçˆ±ä½ </div>
                    <span class="say">æˆ‘çŸ¥é“ï¼Œä½ æ˜¯ä¸€ä¸ªå¤©çœŸã€å–„è‰¯åˆæ¸©æŸ”çš„ç”·å­©</span><br>
                    <span class="say">è¿™æ®µå’Œä½ å¹¶è‚©èµ°è¿‡çš„<span id="duration" class="duration-placeholder">[åŠ è½½ä¸­...]</span>æ—¶å…‰ï¼Œæ˜¯æˆ‘ç”Ÿå‘½é‡Œæœ€æ˜äº®çš„ç« èŠ‚</span><br>
                    <span class="say">å¦‚æœä½ æ„¿æ„ï¼Œè®©æˆ‘ç‰µç´§ä½ çš„æ‰‹ï¼Œåœ¨å±äºæˆ‘ä»¬çš„æ•…äº‹é‡Œ</span><br>
                    <span class="say">å¥½å¥½åœ°ã€å®Œæ•´åœ°å»çˆ±ä¸€æ¬¡</span><br>
                    <br>
                    <span class="say">æˆ‘çˆ±ä½ ï¼Œçˆ±åˆ°æ˜¼å¤œåœ¨å¯»å¸¸å··é™Œé‡Œä¸ºæˆ‘ä»¬è§è¯</span><br>
                    <span class="say">çˆ±åˆ°å››å­£æµè½¬éƒ½æˆä¸ºæˆ‘ä»¬ç›¸å®ˆçš„åºç« </span><br>
                    <span class="say">çˆ±åˆ°æ¯ä¸€ç¼•é£ç»è¿‡ï¼Œéƒ½è®¤å¾—æˆ‘ä¿©å¹¶è‚©çš„èº«å½±</span><br>
                    <span class="say">çˆ±åˆ°ä¸–ç•Œå®‰é™æ—¶ï¼Œåªå¬å¾—åˆ°å½¼æ­¤çš„å¿ƒè·³</span><br>
                    <br>
                    <span class="say">æˆ‘çˆ±ä½ ï¼Œçˆ±åˆ°æ—¶é—´å¤±å»åˆ»åº¦ï¼Œæœªæ¥ä¸å¿…åˆ†æ˜</span><br>
                    <span class="say">çˆ±åˆ°æ— è®ºé‡æ¥å¤šå°‘æ¬¡ï¼Œé€‰æ‹©ä¾ç„¶ä¼šæ˜¯ä½ </span><br>
                    <span class="say">å°±æŠŠè¿™äº›è¯è¯´ç»™æˆ‘æœ€äº²çˆ±çš„ç”·å­©å¬</span><br>
                    <span class="say">æ„¿ä»¥çœŸå¿ƒï¼Œæ¢ä½ æˆ‘å¾€åæœæœæš®æš®</span><br>
                    <span class="say">è®©æˆ‘å¥½å¥½çˆ±ä½ ï¼Œè¡Œå—</span><br>
                    <br>
                    <span class="say"><span class="space"></span> -- æ°¸è¿œçˆ±ä½ çš„å½¬å½¬ã€‚</span>
                </div>
            </div>
            
            <!-- çˆ±æƒ…çºªå¿µå†Œå°†åœ¨è¿™é‡ŒåŠ¨æ€åˆ›å»º -->
            
            <div id="clock-box">
                <span class="romantic-text">å½¬å½¬</span> 
                <span class="heart-icon">â¤</span> å’Œ 
                <span class="heart-icon">â¤</span>
                <span class="romantic-text">é¹é¹</span> çš„çˆ±æƒ…å†ç¨‹
                <div id="clock"></div>
            </div>
        </div>
    </div>
    
    <!-- ç”»å¸ƒ -->
    <canvas id="canvas" width="1100" height="680"></canvas>

    <!-- éŸ³é¢‘ -->
    <audio preload="auto" id="media" loop="loop">
        <source src="love.mp3" type="audio/mpeg">
        <source src="love.ogg" type="audio/ogg">
    </audio>

    <!-- ========== åŠ¨ç”»æ ¸å¿ƒä»£ç å¼€å§‹ ========== -->
    <script>
    // love.js çš„æ ¸å¿ƒåŠ¨ç”»ä»£ç ç›´æ¥å†™åœ¨è¿™é‡Œ
    (function(window){
        function random(min, max) {
            return min + Math.floor(Math.random() * (max - min + 1));
        }

        function bezier(cp, t) {  
            var p1 = cp[0].mul((1 - t) * (1 - t));
            var p2 = cp[1].mul(2 * t * (1 - t));
            var p3 = cp[2].mul(t * t); 
            return p1.add(p2).add(p3);
        }  

        function inheart(x, y, r) {
            var z = ((x / r) * (x / r) + (y / r) * (y / r) - 1) * ((x / r) * (x / r) + (y / r) * (y / r) - 1) * ((x / r) * (x / r) + (y / r) * (y / r) - 1) - (x / r) * (x / r) * (y / r) * (y / r) * (y / r);
            return z < 0;
        }

        Point = function(x, y) {
            this.x = x || 0;
            this.y = y || 0;
        }
        Point.prototype = {
            clone: function() {
                return new Point(this.x, this.y);
            },
            add: function(o) {
                p = this.clone();
                p.x += o.x;
                p.y += o.y;
                return p;
            },
            sub: function(o) {
                p = this.clone();
                p.x -= o.x;
                p.y -= o.y;
                return p;
            },
            div: function(n) {
                p = this.clone();
                p.x /= n;
                p.y /= n;
                return p;
            },
            mul: function(n) {
                p = this.clone();
                p.x *= n;
                p.y *= n;
                return p;
            }
        }

        Heart = function() {
            var points = [], x, y, t;
            for (var i = 10; i < 30; i += 0.2) {
                t = i / Math.PI;
                x = 16 * Math.pow(Math.sin(t), 3);
                y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
                points.push(new Point(x, y));
            }
            this.points = points;
            this.length = points.length;
        }
        Heart.prototype = {
            get: function(i, scale) {
                return this.points[i].mul(scale || 1);
            }
        }

        Seed = function(tree, point, scale, color) {
            this.tree = tree;

            var scale = scale || 1
            var color = color || '#FF0000';

            this.heart = {
                point  : point,
                scale  : scale,
                color  : color,
                figure : new Heart(),
            }

            this.cirle = {
                point  : point,
                scale  : scale,
                color  : color,
                radius : 5,
            }
        }
        Seed.prototype = {
            draw: function() {
                this.drawHeart();
                this.drawText();
            },
            addPosition: function(x, y) {
                this.cirle.point = this.cirle.point.add(new Point(x, y));
            },
            canMove: function() {
                return this.cirle.point.y < (this.tree.height + 20); 
            },
            move: function(x, y) {
                this.clear();
                this.drawCirle();
                this.addPosition(x, y);
            },
            canScale: function() {
                return this.heart.scale > 0.2;
            },
            setHeartScale: function(scale) {
                this.heart.scale *= scale;
            },
            scale: function(scale) {
                this.clear();
                this.drawCirle();
                this.drawHeart();
                this.setHeartScale(scale);
            },
            drawHeart: function() {
                var ctx = this.tree.ctx, heart = this.heart;
                var point = heart.point, color = heart.color, 
                    scale = heart.scale;
                ctx.save();
                ctx.fillStyle = color;
                ctx.translate(point.x, point.y);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                for (var i = 0; i < heart.figure.length; i++) {
                    var p = heart.figure.get(i, scale);
                    ctx.lineTo(p.x, -p.y);
                }
                ctx.closePath();
                ctx.fill();
                ctx.restore();
            },
            drawCirle: function() {
                var ctx = this.tree.ctx, cirle = this.cirle;
                var point = cirle.point, color = cirle.color, 
                    scale = cirle.scale, radius = cirle.radius;
                ctx.save();
                ctx.fillStyle = color;
                ctx.translate(point.x, point.y);
                ctx.scale(scale, scale);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.arc(0, 0, radius, 0, 2 * Math.PI);
                ctx.closePath();
                ctx.fill();
                ctx.restore();
            },
            drawText: function() {
                var ctx = this.tree.ctx, heart = this.heart;
                var point = heart.point, color = heart.color, 
                    scale = heart.scale;
                ctx.save();
                ctx.strokeStyle = color;
                ctx.fillStyle = color;
                ctx.translate(point.x, point.y);
                ctx.scale(scale, scale);
                ctx.moveTo(0, 0);
                ctx.lineTo(15, 15);
                ctx.lineTo(60, 15);
                ctx.stroke();

                ctx.moveTo(0, 0);
                ctx.scale(0.75, 0.75);
                ctx.font = "12px å¾®è½¯é›…é»‘,Verdana";
                ctx.fillText("click here", 23, 16);
                ctx.restore();
            },
            clear: function() {
                var ctx = this.tree.ctx, cirle = this.cirle;
                var point = cirle.point, scale = cirle.scale, radius = 26;
                var w = h = (radius * scale);
                ctx.clearRect(point.x - w, point.y - h, 4 * w, 4 * h);
            },
            hover: function(x, y) {
                var ctx = this.tree.ctx;
                var pixel = ctx.getImageData(x, y, 1, 1);
                return pixel.data[3] == 255
            }
        }

        Footer = function(tree, width, height, speed) {
            this.tree = tree;
            this.point = new Point(tree.seed.heart.point.x, tree.height - height / 2);
            this.width = width;
            this.height = height;
            this.speed = speed || 2;
            this.length = 0;
        }
        Footer.prototype = {
            draw: function() {
                var ctx = this.tree.ctx, point = this.point;
                var len = this.length / 2;

                ctx.save();
                ctx.strokeStyle = 'rgb(35, 31, 32)';
                ctx.lineWidth = this.height;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.translate(point.x, point.y);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(len, 0);
                ctx.lineTo(-len, 0);
                ctx.stroke();
                ctx.restore();

                if (this.length < this.width) {
                    this.length += this.speed;
                }
            }
        }

        Tree = function(canvas, width, height, opt) {
            this.canvas = canvas;
            this.ctx = canvas.getContext('2d');
            this.width = width;
            this.height = height;
            this.opt = opt || {};

            this.record = {};
            
            this.initSeed();
            this.initFooter();
            this.initBranch();
            this.initBloom();
        }
        Tree.prototype = {
            initSeed: function() {
                var seed = this.opt.seed || {};
                var x = seed.x || this.width / 2;
                var y = seed.y || this.height / 2;
                var point = new Point(x, y);
                var color = seed.color || '#FF0000';
                var scale = seed.scale || 1;

                this.seed = new Seed(this, point, scale, color);
            },

            initFooter: function() {
                var footer = this.opt.footer || {};
                var width = footer.width || this.width;
                var height = footer.height || 5;
                var speed = footer.speed || 2;
                this.footer = new Footer(this, width, height, speed);
            },

            initBranch: function() {
                var branchs = this.opt.branch || []
                this.branchs = [];
                this.addBranchs(branchs);
            },

            initBloom: function() {
                var bloom = this.opt.bloom || {};
                var cache = [],
                    num = bloom.num || 500, 
                    width = bloom.width || this.width,
                    height = bloom.height || this.height,
                    figure = this.seed.heart.figure;
                var r = 240, x, y;
                for (var i = 0; i < num; i++) {
                    cache.push(this.createBloom(width, height, r, figure));
                }
                this.blooms = [];
                this.bloomsCache = cache;
            },

            toDataURL: function(type) {
                return this.canvas.toDataURL(type);
            },

            draw: function(k) {
                var s = this, ctx = s.ctx;
                var rec = s.record[k];
                if (!rec) {
                    return ;
                }
                var point = rec.point,
                    image = rec.image;

                ctx.save();
                ctx.putImageData(image, point.x, point.y);
                ctx.restore();
            },

            addBranch: function(branch) {
                this.branchs.push(branch);
            },

            addBranchs: function(branchs){
                var s = this, b, p1, p2, p3, r, l, c;
                for (var i = 0; i < branchs.length; i++) {
                    b = branchs[i];
                    p1 = new Point(b[0], b[1]);
                    p2 = new Point(b[2], b[3]);
                    p3 = new Point(b[4], b[5]);
                    r = b[6];
                    l = b[7];
                    c = b[8]
                    s.addBranch(new Branch(s, p1, p2, p3, r, l, c)); 
                }
            },

            removeBranch: function(branch) {
                var branchs = this.branchs;
                for (var i = 0; i < branchs.length; i++) {
                    if (branchs[i] === branch) {
                        branchs.splice(i, 1);
                    }
                }
            },

            canGrow: function() {
                return !!this.branchs.length;
            },
            grow: function() {
                var branchs = this.branchs;
                for (var i = 0; i < branchs.length; i++) {
                    var branch = branchs[i];
                    if (branch) {
                        branch.grow();
                    }
                }
            },

            addBloom: function (bloom) {
                this.blooms.push(bloom);
            },

            removeBloom: function (bloom) {
                var blooms = this.blooms;
                for (var i = 0; i < blooms.length; i++) {
                    if (blooms[i] === bloom) {
                        blooms.splice(i, 1);
                    }
                }
            },

            createBloom: function(width, height, radius, figure, color, alpha, angle, scale, place, speed) {
                var x, y;
                while (true) {
                    x = random(20, width - 20);
                    y = random(20, height - 20);
                    if (inheart(x - width / 2, height - (height - 40) / 2 - y, radius)) {
                        return new Bloom(this, new Point(x, y), figure, color, alpha, angle, scale, place, speed);
                    }
                }
            },
            
            canFlower: function() {
                return !!this.blooms.length;
            }, 
            flower: function(num) {
                var s = this, blooms = s.bloomsCache.splice(0, num);
                for (var i = 0; i < blooms.length; i++) {
                    s.addBloom(blooms[i]);
                }
                blooms = s.blooms;
                for (var j = 0; j < blooms.length; j++) {
                    blooms[j].flower();
                }
            },

            snapshot: function(k, x, y, width, height) {
                var ctx = this.ctx;
                var image = ctx.getImageData(x, y, width, height); 
                this.record[k] = {
                    image: image,
                    point: new Point(x, y),
                    width: width,
                    height: height
                }
            },
            setSpeed: function(k, speed) {
                this.record[k || "move"].speed = speed;
            },
            move: function(k, x, y) {
                var s = this, ctx = s.ctx;
                var rec = s.record[k || "move"];
                var point = rec.point,
                    image = rec.image,
                    speed = rec.speed || 10,
                    width = rec.width,
                    height = rec.height; 

                i = point.x + speed < x ? point.x + speed : x;
                j = point.y + speed < y ? point.y + speed : y; 

                ctx.save();
                ctx.clearRect(point.x, point.y, width, height);
                ctx.putImageData(image, i, j);
                ctx.restore();

                rec.point = new Point(i, j);
                rec.speed = speed * 0.95;

                if (rec.speed < 2) {
                    rec.speed = 2;
                }
                return i < x || j < y;
            },

            jump: function() {
                var s = this, blooms = s.blooms;
                if (blooms.length) {
                    for (var i = 0; i < blooms.length; i++) {
                        blooms[i].jump();
                    }
                } 
                if ((blooms.length && blooms.length < 3) || !blooms.length) {
                    var bloom = this.opt.bloom || {},
                        width = bloom.width || this.width,
                        height = bloom.height || this.height,
                        figure = this.seed.heart.figure;
                    var r = 240, x, y;
                    for (var i = 0; i < random(1,2); i++) {
                        blooms.push(this.createBloom(width / 2 + width, height, r, figure, null, 1, null, 1, new Point(random(-100,600), 720), random(200,300)));
                    }
                }
            }
        }

        Branch = function(tree, point1, point2, point3, radius, length, branchs) {
            this.tree = tree;
            this.point1 = point1;
            this.point2 = point2;
            this.point3 = point3;
            this.radius = radius;
            this.length = length || 100;    
            this.len = 0;
            this.t = 1 / (this.length - 1);   
            this.branchs = branchs || [];
        }

        Branch.prototype = {
            grow: function() {
                var s = this, p; 
                if (s.len <= s.length) {
                    p = bezier([s.point1, s.point2, s.point3], s.len * s.t);
                    s.draw(p);
                    s.len += 1;
                    s.radius *= 0.97;
                } else {
                    s.tree.removeBranch(s);
                    s.tree.addBranchs(s.branchs);
                }
            },
            draw: function(p) {
                var s = this;
                var ctx = s.tree.ctx;
                ctx.save();
                ctx.beginPath();
                ctx.fillStyle = 'RGB(0,128,128)';
                ctx.shadowColor = '#22b822';
                ctx.shadowBlur = 2;
                ctx.moveTo(p.x, p.y);
                ctx.arc(p.x, p.y, s.radius, 0, 2 * Math.PI);
                ctx.closePath();
                ctx.fill();
                ctx.restore();
            }
        }

        Bloom = function(tree, point, figure, color, alpha, angle, scale, place, speed) {
            this.tree = tree;
            this.point = point;
            this.color = color || 'rgb(255,' + random(0, 255) + ',' + random(0, 255) + ')';
            this.alpha = alpha || random(0.3, 1);
            this.angle = angle || random(0, 360);
            this.scale = scale || 0.1;
            this.place = place;
            this.speed = speed;

            this.figure = figure;
        }
        Bloom.prototype = {
            setFigure: function(figure) {
                this.figure = figure;
            },
            flower: function() {
                var s = this;
                s.draw();
                s.scale += 0.1;
                if (s.scale > 1) {
                    s.tree.removeBloom(s);
                }
            },
            draw: function() {
                var s = this, ctx = s.tree.ctx, figure = s.figure;

                ctx.save();
                ctx.fillStyle = s.color;
                ctx.globalAlpha = s.alpha;
                ctx.translate(s.point.x, s.point.y);
                ctx.scale(s.scale, s.scale);
                ctx.rotate(s.angle);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                for (var i = 0; i < figure.length; i++) {
                    var p = figure.get(i);
                    ctx.lineTo(p.x, -p.y);
                }
                ctx.closePath();
                ctx.fill();
                ctx.restore();
            },
            jump: function() {
                var s = this, height = s.tree.height;

                if (s.point.x < -20 || s.point.y > height + 20) {
                    s.tree.removeBloom(s);
                } else {
                    s.draw();
                    s.point = s.place.sub(s.point).div(s.speed).add(s.point);
                    s.angle += 0.05;
                    s.speed -= 1;
                }
            }
        }

        window.random = random;
        window.bezier = bezier;
        window.Point = Point;
        window.Tree = Tree;

    })(window);
    </script>
    <!-- ========== åŠ¨ç”»æ ¸å¿ƒä»£ç ç»“æŸ ========== -->

    <!-- ========== é¡µé¢é€»è¾‘ä»£ç  ========== -->
    <script>
        // å¼€å§‹æ—¥æœŸ
        const startDate = new Date('2024-05-24');
        
        // åŠ¨ç”»çŠ¶æ€
        let animationStarted = false;
        
        // éŸ³ä¹æ§åˆ¶
        const audio = document.getElementById('media');
        const musicControl = document.getElementById('musicControl');
        let musicStarted = false;
        
        // åˆå§‹åŒ–éŸ³ä¹
        audio.volume = 0.5;
        
        // éŸ³ä¹æ§åˆ¶
        musicControl.addEventListener('click', function() {
            if (audio.paused) {
                audio.play();
                musicControl.innerHTML = '<i>ğŸµ</i>';
            } else {
                audio.pause();
                musicControl.innerHTML = '<i>ğŸ”‡</i>';
            }
        });
        
        // åˆ›å»ºæµ®åŠ¨çˆ±å¿ƒ
        function createFloatingHearts() {
            const heartsContainer = document.getElementById('floating-hearts');
            const heartCount = 20;
            
            for (let i = 0; i < heartCount; i++) {
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                heart.innerHTML = 'â¤';
                heart.style.left = Math.random() * 100 + '%';
                heart.style.fontSize = (Math.random() * 12 + 10) + 'px';
                heart.style.animationDelay = Math.random() * 15 + 's';
                heart.style.animationDuration = (Math.random() * 10 + 15) + 's';
                heart.style.color = `rgba(255, ${Math.random() * 100 + 64}, ${Math.random() * 100 + 129}, 0.6)`;
                heartsContainer.appendChild(heart);
            }
        }
        
        // è®¡ç®—æ—¶é—´é—´éš”
        function calculateRomanticDuration() {
            const now = new Date();
            const diffTime = Math.abs(now - startDate);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return "åˆšåˆšå¼€å§‹çš„ç¾å¥½";
            if (diffDays === 1) return "ç”œèœœçš„ç¬¬ä¸€å¤©";
            if (diffDays < 7) return diffDays + "ä¸ªç”œèœœæ—¥å¤œ";
            if (diffDays < 30) {
                const weeks = Math.floor(diffDays / 7);
                return weeks + "å‘¨çš„ç¾å¥½æ—¶å…‰";
            }
            if (diffDays < 365) {
                const months = Math.floor(diffDays / 30);
                const days = diffDays % 30;
                return months + "ä¸ªæœˆ" + (days > 0 ? days + "å¤©" : "") + "çš„é™ªä¼´";
            }
            const years = Math.floor(diffDays / 365);
            const months = Math.floor((diffDays % 365) / 30);
            return years + "å¹´" + (months > 0 ? months + "ä¸ªæœˆ" : "") + "çš„æ°¸æ’ä¹‹çº¦";
        }
        
        // è®¡ç®—åœ¨ä¸€èµ·å¤©æ•°
        function calculateTogetherDays() {
            const now = new Date();
            const diffTime = Math.abs(now - startDate);
            return Math.floor(diffTime / (1000 * 60 * 60 * 24));
        }
        
        // è®¡ç®—è·ç¦»ä¸‹ä¸€ä¸ªç™¾å¤©çºªå¿µæ—¥
        function calculateNextHundredDays() {
            const togetherDays = calculateTogetherDays();
            const nextHundred = Math.ceil((togetherDays + 1) / 100) * 100;
            return nextHundred - togetherDays;
        }
        
        // åˆ›å»ºçˆ±æƒ…çºªå¿µå†Œ - åœ¨åŠ¨ç”»å®Œå…¨ç»“æŸåæ‰è°ƒç”¨
        function createLoveAlbum() {
            const wrap = document.getElementById('wrap');
            const clockBox = document.getElementById('clock-box');
            
            // åˆ›å»ºçºªå¿µå†ŒHTML
            const albumHTML = `
                <div class="love-album">
                    <h3>â¤ æˆ‘ä»¬çš„çˆ±æƒ…çºªå¿µå†Œ â¤</h3>
                    
                    <div class="romantic-date">
                        <span class="heart-icon">â¤</span>
                        ä»Šå¤©ï¼š<span id="current-date">${new Date().toLocaleDateString('zh-CN', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric', 
                            weekday: 'long' 
                        })}</span>
                        <span class="heart-icon">â¤</span>
                    </div>
                    
                    <div class="love-metric">
                        <div class="metric-box">
                            <span class="metric-label">åœ¨ä¸€èµ·å¤©æ•°</span>
                            <span class="metric-value">${calculateTogetherDays()}</span>
                            <span class="heart-icon">â¤</span>
                        </div>
                        
                        <div class="metric-box">
                            <span class="metric-label">ä¸‹ä¸ªçºªå¿µæ—¥</span>
                            <span class="metric-value">${calculateNextHundredDays()}</span>
                            <span class="metric-label">å¤©å</span>
                        </div>
                        
                        <div class="metric-box">
                            <span class="metric-label">çˆ±æƒ…æ¸©åº¦</span>
                            <span class="metric-value">100Â°</span>
                            <span class="heart-icon">â™¥</span>
                        </div>
                    </div>
                    
                    <div class="love-note">
                        æ¯ä¸€åˆ†æ¯ä¸€ç§’ï¼Œçˆ±ä½ éƒ½åœ¨åŠ æ·±ä¸€åˆ†<br>
                        ä» <span style="color: #e91e63; font-weight: bold;">${startDate.toLocaleDateString('zh-CN', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        })}</span> å¼€å§‹ï¼Œæˆ‘ä»¬çš„æ•…äº‹æ°¸ä¸ç»“æŸ
                    </div>
                </div>
            `;
            
            // åœ¨æ—¶é’Ÿç›’å­ä¹‹å‰æ’å…¥çºªå¿µå†Œ
            clockBox.insertAdjacentHTML('beforebegin', albumHTML);
        }
        
        // å¼€å§‹ä½“éªŒ
        function startExperience() {
            if (animationStarted) return;
            animationStarted = true;
            
            const seedContainer = document.getElementById('seedContainer');
            const mainContent = document.getElementById('main');
            const textElement = document.getElementById('text');
            
            // æ·¡å‡ºç§å­é¡µé¢
            seedContainer.classList.add('hidden');
            
            // å¼€å§‹éŸ³ä¹
            if (!musicStarted) {
                audio.play().then(() => {
                    musicStarted = true;
                });
            }
            
            // 1ç§’åå¼€å§‹åŠ¨ç”»
            setTimeout(() => {
                seedContainer.style.display = 'none';
                mainContent.style.display = 'block';
                
                // æ˜¾ç¤ºéŸ³ä¹æ§åˆ¶æŒ‰é’®
                setTimeout(() => {
                    musicControl.classList.add('show');
                }, 2000);
                
                // æ›´æ–°æƒ…ä¹¦ä¸­çš„æ—¶é—´
                document.getElementById('duration').textContent = calculateRomanticDuration();
                
                // å¼€å§‹å¤§æ ‘ç”Ÿé•¿åŠ¨ç”»
                startTreeAnimation();
                
                // 3ç§’åæ˜¾ç¤ºæƒ…ä¹¦ï¼ˆæ‰“å­—æ•ˆæœï¼‰
                setTimeout(() => {
                    textElement.classList.add('show');
                    $("#code").show().typewriter();
                    
                    // æƒ…ä¹¦åŠ¨ç”»å®Œæˆåï¼ˆçº¦10ç§’åï¼‰ï¼Œåˆ›å»ºå¹¶æ˜¾ç¤ºçˆ±æƒ…çºªå¿µå†Œ
                    setTimeout(createLoveAlbum, 10000);
                }, 3000);
                
            }, 1000);
        }
        
        // å¼€å§‹å¤§æ ‘ç”Ÿé•¿åŠ¨ç”»
        function startTreeAnimation() {
            // è®¾ç½®åŠ¨ç”»å‚æ•°
            var canvas = $('#canvas');
            var width = canvas.width();
            var height = canvas.height();

            var opts = {
                seed: {
                    x: width / 2 - 20,
                    color: "rgb(190, 26, 37)",
                    scale: 2
                },
                branch: [
                    [535, 680, 570, 250, 500, 200, 30, 100, [
                        [540, 500, 455, 417, 340, 400, 13, 100, [
                            [450, 435, 434, 430, 394, 395, 2, 40]
                        ]],
                        [550, 445, 600, 356, 680, 345, 12, 100, [
                            [578, 400, 648, 409, 661, 426, 3, 80]
                        ]],
                        [539, 281, 537, 248, 534, 217, 3, 40],
                        [546, 397, 413, 247, 328, 244, 9, 80, [
                            [427, 286, 383, 253, 371, 205, 2, 40],
                            [498, 345, 435, 315, 395, 330, 4, 60]
                        ]],
                        [546, 357, 608, 252, 678, 221, 6, 100, [
                            [590, 293, 646, 277, 648, 271, 2, 80]
                        ]]
                    ]]
                ],
                bloom: {
                    num: 700,
                    width: 1080,
                    height: 650,
                },
                footer: {
                    width: 1200,
                    height: 5,
                    speed: 10,
                }
            }

            // åˆ›å»ºæ ‘å®ä¾‹å¹¶å¼€å§‹åŠ¨ç”»
            var tree = new Tree(canvas[0], width, height, opts);
            var seed = tree.seed;
            var foot = tree.footer;
            
            // ä½¿ç”¨Jscexæ§åˆ¶åŠ¨ç”»åºåˆ—
            var seedAnimate = eval(Jscex.compile("async", function () {
                seed.draw();
                while (true) {
                    $await(Jscex.Async.sleep(10));
                    // ç‚¹å‡»åç«‹å³å¼€å§‹ç”Ÿé•¿
                    break;
                }
                while (seed.canScale()) {
                    seed.scale(0.95);
                    $await(Jscex.Async.sleep(10));
                }
                while (seed.canMove()) {
                    seed.move(0, 2);
                    foot.draw();
                    $await(Jscex.Async.sleep(10));
                }
            }));

            var growAnimate = eval(Jscex.compile("async", function () {
                do {
                    tree.grow();
                    $await(Jscex.Async.sleep(10));
                } while (tree.canGrow());
            }));

            var flowAnimate = eval(Jscex.compile("async", function () {
                do {
                    tree.flower(2);
                    $await(Jscex.Async.sleep(10));
                } while (tree.canFlower());
            }));

            var moveAnimate = eval(Jscex.compile("async", function () {
                tree.snapshot("p1", 240, 0, 610, 680);
                while (tree.move("p1", 500, 0)) {
                    foot.draw();
                    $await(Jscex.Async.sleep(10));
                }
                foot.draw();
                tree.snapshot("p2", 500, 0, 610, 680);

                canvas.parent().css("background", "url(" + tree.toDataURL('image/png') + ")");
                canvas.css("background", "#ffc0cb");
                $await(Jscex.Async.sleep(300));
                canvas.css("background", "none");
            }));

            var jumpAnimate = eval(Jscex.compile("async", function () {
                var ctx = tree.ctx;
                while (true) {
                    tree.ctx.clearRect(0, 0, width, height);
                    tree.jump();
                    foot.draw();
                    $await(Jscex.Async.sleep(25));
                }
            }));

            var textAnimate = eval(Jscex.compile("async", function () {
                var together = new Date();
                together.setFullYear(2024, 4, 24);
                together.setHours(0);
                together.setMinutes(0);
                together.setSeconds(0);
                together.setMilliseconds(0);

                $("#clock-box").fadeIn(500);
                
                while (true) {
                    timeElapse(together);
                    $await(Jscex.Async.sleep(1000));
                }
            }));

            var runAsync = eval(Jscex.compile("async", function () {
                $await(seedAnimate());
                $await(growAnimate());
                $await(flowAnimate());
                $await(moveAnimate());

                textAnimate().start();

                $await(jumpAnimate());
            }));

            // å¼€å§‹åŠ¨ç”»
            runAsync().start();
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            createFloatingHearts();
            document.getElementById('seedContainer').addEventListener('click', startExperience);
        });
    </script>
</body>
</html>
